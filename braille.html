<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6-Dot Braille Editor (UEB) - Dual View</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
    }
    
    header {
      background: #16213e;
      padding: 15px 20px;
      border-bottom: 2px solid #4fc3f7;
    }
    
    h1 {
      color: #4fc3f7;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .subtitle {
      color: #888;
      font-size: 0.9em;
    }
    
    .main-container {
      display: grid;
      grid-template-columns: 280px 1fr;
      height: calc(100vh - 70px);
    }
    
    /* Sidebar */
    .sidebar {
      background: #16213e;
      padding: 20px;
      border-right: 1px solid #2d2d44;
      overflow-y: auto;
    }
    
    .section-title {
      font-size: 0.85em;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      padding-bottom: 5px;
      border-bottom: 1px solid #2d2d44;
    }
    
    .keyboard-layout {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .hand {
      display: grid;
      grid-template-columns: repeat(3, 40px);
      gap: 5px;
    }
    
    .key {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: #2d2d44;
      border: 2px solid #3d3d5c;
      border-radius: 6px;
      font-size: 0.9em;
      transition: all 0.1s;
    }
    
    .key.active {
      background: #4fc3f7;
      border-color: #4fc3f7;
      color: #000;
    }
    
    .key-letter { font-weight: bold; }
    .key-dot { font-size: 0.65em; opacity: 0.6; }
    
    /* Current input preview */
    .preview-box {
      background: #0f0f23;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .preview-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .preview-label {
      font-size: 0.8em;
      color: #888;
    }
    
    .preview-value {
      font-size: 1.5em;
      min-width: 50px;
      text-align: right;
    }
    
    .braille-display {
      font-family: 'Noto Sans Mono', 'Apple Braille', monospace;
      color: #4fc3f7;
      font-size: 2.5em;
    }
    
    .text-display {
      color: #81c784;
    }
    
    .dots-display {
      color: #ff9800;
      font-size: 1.2em;
    }
    
    /* Controls */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    button {
      padding: 10px;
      font-size: 0.9em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    
    button.primary { background: #4fc3f7; color: #000; }
    button.primary:hover { background: #81d4fa; }
    button.secondary { background: #2d2d44; color: #fff; }
    button.secondary:hover { background: #3d3d5c; }
    button.danger { background: #c62828; color: #fff; }
    button.danger:hover { background: #e53935; }
    
    /* Instructions */
    .instructions {
      font-size: 0.85em;
      color: #aaa;
      line-height: 1.6;
    }
    
    .instructions kbd {
      background: #2d2d44;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.9em;
    }
    
    /* Main editor area */
    .editor-area {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow: hidden;
    }
    
    .dual-editors {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      flex: 1;
      min-height: 0;
    }
    
    .editor-panel {
      display: flex;
      flex-direction: column;
      background: #0f0f23;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid #2d2d44;
    }
    
    .editor-panel:focus-within {
      border-color: #4fc3f7;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: #16213e;
      border-bottom: 1px solid #2d2d44;
    }
    
    .panel-title {
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .panel-title .icon {
      font-size: 1.2em;
    }
    
    .char-count {
      font-size: 0.8em;
      color: #888;
    }
    
    .editor-content {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      font-size: 1.8em;
      line-height: 1.8;
      word-break: break-all;
      white-space: pre-wrap;
      font-family: 'Noto Sans Mono', 'Apple Braille', monospace;
    }
    
    #braille-editor {
      color: #4fc3f7;
    }
    
    #text-editor {
      color: #81c784;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .cursor {
      display: inline-block;
      width: 2px;
      height: 1em;
      background: #4fc3f7;
      animation: blink 1s infinite;
      vertical-align: middle;
      margin-left: 2px;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* Status bar */
    .status-bar {
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      background: #16213e;
      border-radius: 8px;
      font-size: 0.85em;
      color: #888;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4caf50;
    }
    
    /* Alphabet reference */
    .alphabet-ref {
      margin-top: 20px;
      font-size: 0.8em;
    }
    
    .alphabet-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 3px;
      margin-top: 10px;
    }
    
    .alpha-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      background: #0f0f23;
      border-radius: 4px;
    }
    
    .alpha-braille {
      font-size: 1.3em;
      color: #4fc3f7;
    }
    
    .alpha-text {
      color: #81c784;
    }
    
    .alpha-dots {
      color: #666;
      font-size: 0.85em;
      margin-left: auto;
    }

    /* Highlight current character in reference */
    .alpha-item.highlight {
      background: #4fc3f7;
      color: #000;
    }
    
    .alpha-item.highlight .alpha-braille,
    .alpha-item.highlight .alpha-text,
    .alpha-item.highlight .alpha-dots {
      color: #000;
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <span>⠃⠗⠁⠊⠇⠇⠑</span>
      <span>6-Dot Braille Editor</span>
    </h1>
    <div class="subtitle">Unified English Braille (UEB) Grade 1 - Learning Mode</div>
  </header>
  
  <div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="section-title">Input Keys</div>
      
      <div class="keyboard-layout">
        <div class="hand">
          <div class="key" data-key="f" data-dot="1">
            <span class="key-letter">F</span>
            <span class="key-dot">1</span>
          </div>
          <div class="key" data-key="d" data-dot="2">
            <span class="key-letter">D</span>
            <span class="key-dot">2</span>
          </div>
          <div class="key" data-key="s" data-dot="3">
            <span class="key-letter">S</span>
            <span class="key-dot">3</span>
          </div>
        </div>
        <div class="hand">
          <div class="key" data-key="j" data-dot="4">
            <span class="key-letter">J</span>
            <span class="key-dot">4</span>
          </div>
          <div class="key" data-key="k" data-dot="5">
            <span class="key-letter">K</span>
            <span class="key-dot">5</span>
          </div>
          <div class="key" data-key="l" data-dot="6">
            <span class="key-letter">L</span>
            <span class="key-dot">6</span>
          </div>
        </div>
      </div>
      
      <div class="section-title">Current Input</div>
      
      <div class="preview-box">
        <div class="preview-row">
          <span class="preview-label">Braille</span>
          <span class="preview-value braille-display" id="braille-preview">⠀</span>
        </div>
        <div class="preview-row">
          <span class="preview-label">Text</span>
          <span class="preview-value text-display" id="text-preview">-</span>
        </div>
        <div class="preview-row">
          <span class="preview-label">Dots</span>
          <span class="preview-value dots-display" id="dots-preview">-</span>
        </div>
      </div>
      
      <div class="controls">
        <button class="primary" onclick="confirmChar()">⏎ Confirm (Space)</button>
        <button class="secondary" onclick="deleteLastChar()">⌫ Delete Last</button>
        <button class="secondary" onclick="copyToClipboard('braille')">Copy Braille</button>
        <button class="secondary" onclick="copyToClipboard('text')">Copy Text</button>
        <button class="danger" onclick="clearEditor()">Clear All</button>
      </div>
      
      <div class="section-title">How to Input</div>
      
      <div class="instructions">
        <p>Hold <kbd>F</kbd><kbd>D</kbd><kbd>S</kbd> + <kbd>J</kbd><kbd>K</kbd><kbd>L</kbd> to form dots.</p>
        <p style="margin-top:8px">Press <kbd>Space</kbd> to confirm character.</p>
        <p style="margin-top:8px"><kbd>Backspace</kbd> deletes last char.</p>
        <p style="margin-top:8px"><kbd>Esc</kbd> clears current input.</p>
      </div>
      
      <div class="alphabet-ref">
        <div class="section-title">Alphabet Reference</div>
        <div class="alphabet-grid" id="alphabet-grid"></div>
      </div>
    </div>
    
    <!-- Main Editor Area -->
    <div class="editor-area">
      <div class="dual-editors">
        <!-- Braille Editor -->
        <div class="editor-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="icon">⠿</span>
              <span>Braille (点字)</span>
            </div>
            <span class="char-count" id="braille-count">0 chars</span>
          </div>
          <div class="editor-content" id="braille-editor"><span class="cursor"></span></div>
        </div>
        
        <!-- Text Editor -->
        <div class="editor-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="icon">Aa</span>
              <span>Ink Text (墨字)</span>
            </div>
            <span class="char-count" id="text-count">0 chars</span>
          </div>
          <div class="editor-content" id="text-editor"><span class="cursor"></span></div>
        </div>
      </div>
      
      <div class="status-bar">
        <div class="status-item">
          <span class="status-dot"></span>
          <span>Ready</span>
        </div>
        <div class="status-item">
          <span>Mode: UEB Grade 1</span>
        </div>
        <div class="status-item">
          <span>Focus anywhere to type</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== CONFIGURATION ====================
    const BRAILLE_START = 0x2800;
    const KEY_MAP = { f: 1, d: 2, s: 3, j: 4, k: 5, l: 6 };
    
    // UEB Grade 1 mapping (braille code -> text)
    const UEB_GRADE1 = {
      0x01: 'a', 0x03: 'b', 0x09: 'c', 0x19: 'd', 0x11: 'e',
      0x0b: 'f', 0x1b: 'g', 0x13: 'h', 0x0a: 'i', 0x1a: 'j',
      0x05: 'k', 0x07: 'l', 0x0d: 'm', 0x1d: 'n', 0x15: 'o',
      0x0f: 'p', 0x1f: 'q', 0x17: 'r', 0x0e: 's', 0x1e: 't',
      0x25: 'u', 0x27: 'v', 0x3a: 'w', 0x2d: 'x', 0x3d: 'y',
      0x35: 'z',
      // Punctuation & symbols
      0x2c: ',', 0x3c: ';', 0x36: ':', 0x26: '.', 0x14: '?',
      0x32: '!', 0x04: "'", 0x24: '"', 0x3e: '-', 0x00: ' ',
      // Special
      0x20: '⠠',  // Capital sign
      0x3c: '⠼',  // Number sign
      0x2e: '/',  // Slash
    };
    
    // Reverse mapping for reference display
    const TEXT_TO_BRAILLE = {};
    Object.entries(UEB_GRADE1).forEach(([code, text]) => {
      if (text.length === 1 && text !== '⠠' && text !== '⠼') {
        TEXT_TO_BRAILLE[text] = parseInt(code);
      }
    });
    
    // ==================== STATE ====================
    let activeDots = new Set();
    let brailleContent = '';  // Stores braille characters
    let textContent = '';     // Stores decoded text
    
    // ==================== DOM ELEMENTS ====================
    const braillePreview = document.getElementById('braille-preview');
    const textPreview = document.getElementById('text-preview');
    const dotsPreview = document.getElementById('dots-preview');
    const brailleEditor = document.getElementById('braille-editor');
    const textEditor = document.getElementById('text-editor');
    const brailleCount = document.getElementById('braille-count');
    const textCount = document.getElementById('text-count');
    const alphabetGrid = document.getElementById('alphabet-grid');
    
    // ==================== UTILITY FUNCTIONS ====================
    
    function dotsToCode(dots) {
      let code = 0;
      dots.forEach(dot => code |= (1 << (dot - 1)));
      return code;
    }
    
    function codeToBraille(code) {
      return String.fromCharCode(BRAILLE_START + code);
    }
    
    function dotsToBraille(dots) {
      return codeToBraille(dotsToCode(dots));
    }
    
    function codeToText(code) {
      return UEB_GRADE1[code] || '?';
    }
    
    function dotsArray(dots) {
      return Array.from(dots).sort((a, b) => a - b);
    }
    
    // ==================== DISPLAY FUNCTIONS ====================
    
    function updatePreview() {
      if (activeDots.size === 0) {
        braillePreview.textContent = '\u2800';
        textPreview.textContent = '-';
        dotsPreview.textContent = '-';
        clearAlphabetHighlight();
        return;
      }
      
      const code = dotsToCode(activeDots);
      const braille = codeToBraille(code);
      const text = codeToText(code);
      const dots = dotsArray(activeDots).join('-');
      
      braillePreview.textContent = braille;
      textPreview.textContent = text;
      dotsPreview.textContent = dots;
      
      highlightAlphabet(code);
    }
    
    function updateEditors() {
      // Update braille display
      brailleEditor.innerHTML = brailleContent + '<span class="cursor"></span>';
      
      // Update text display
      textEditor.innerHTML = textContent + '<span class="cursor"></span>';
      
      // Update counts
      brailleCount.textContent = `${brailleContent.length} chars`;
      textCount.textContent = `${textContent.length} chars`;
      
      // Sync scroll positions
      textEditor.scrollTop = brailleEditor.scrollTop;
    }
    
    function updateKeyVisual(key, active) {
      const keyEl = document.querySelector(`.key[data-key="${key}"]`);
      if (keyEl) keyEl.classList.toggle('active', active);
    }
    
    // ==================== ALPHABET REFERENCE ====================
    
    function buildAlphabetReference() {
      const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
      
      alphabetGrid.innerHTML = letters.map(letter => {
        const code = TEXT_TO_BRAILLE[letter];
        if (code === undefined) return '';
        
        const braille = codeToBraille(code);
        const dots = [];
        for (let i = 1; i <= 6; i++) {
          if (code & (1 << (i - 1))) dots.push(i);
        }
        
        return `
          <div class="alpha-item" data-code="${code}">
            <span class="alpha-braille">${braille}</span>
            <span class="alpha-text">${letter}</span>
            <span class="alpha-dots">${dots.join('')}</span>
          </div>
        `;
      }).join('');
    }
    
    function highlightAlphabet(code) {
      clearAlphabetHighlight();
      const item = document.querySelector(`.alpha-item[data-code="${code}"]`);
      if (item) item.classList.add('highlight');
    }
    
    function clearAlphabetHighlight() {
      document.querySelectorAll('.alpha-item.highlight').forEach(el => {
        el.classList.remove('highlight');
      });
    }
    
    // ==================== INPUT ACTIONS ====================
    
    function confirmChar() {
      if (activeDots.size === 0) return;
      
      const code = dotsToCode(activeDots);
      const braille = codeToBraille(code);
      const text = codeToText(code);
      
      brailleContent += braille;
      textContent += text;
      
      resetDots();
      updateEditors();
    }
    
    function deleteLastChar() {
      if (brailleContent.length === 0) return;
      
      // Remove last character
      brailleContent = brailleContent.slice(0, -1);
      textContent = textContent.slice(0, -1);
      
      updateEditors();
    }
    
    function clearEditor() {
      brailleContent = '';
      textContent = '';
      resetDots();
      updateEditors();
    }
    
    function resetDots() {
      activeDots.clear();
      document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
      updatePreview();
    }
    
    async function copyToClipboard(type) {
      const text = type === 'braille' ? brailleContent : textContent;
      
      try {
        await navigator.clipboard.writeText(text);
        
        // Visual feedback
        const btns = document.querySelectorAll('.controls button');
        const btn = type === 'braille' ? btns[2] : btns[3];
        const original = btn.textContent;
        btn.textContent = '✓ Copied!';
        btn.style.background = '#4caf50';
        setTimeout(() => {
          btn.textContent = original;
          btn.style.background = '';
        }, 1500);
      } catch (err) {
        console.error('Copy failed:', err);
      }
    }
    
    // ==================== EVENT HANDLERS ====================
    
    document.addEventListener('keydown', (e) => {
      const key = e.key.toLowerCase();
      
      // Braille input keys
      if (key in KEY_MAP) {
        e.preventDefault();
        if (!activeDots.has(KEY_MAP[key])) {
          activeDots.add(KEY_MAP[key]);
          updateKeyVisual(key, true);
          updatePreview();
        }
        return;
      }
      
      // Space = confirm
      if (e.code === 'Space') {
        if (activeDots.size > 0) {
          e.preventDefault();
          confirmChar();
        }
        return;
      }
      
      // Backspace = delete
      if (e.key === 'Backspace') {
        e.preventDefault();
        if (activeDots.size > 0) {
          resetDots();
        } else {
          deleteLastChar();
        }
        return;
      }
      
      // Escape = clear dots
      if (e.key === 'Escape') {
        resetDots();
        return;
      }
      
      // Enter = add newline
      if (e.key === 'Enter') {
        e.preventDefault();
        brailleContent += '\n';
        textContent += '\n';
        updateEditors();
        return;
      }
    });
    
    document.addEventListener('keyup', (e) => {
      const key = e.key.toLowerCase();
      if (key in KEY_MAP) {
        updateKeyVisual(key, false);
      }
    });
    
    // Click/touch support for keys
    document.querySelectorAll('.key').forEach(keyEl => {
      keyEl.addEventListener('mousedown', (e) => {
        e.preventDefault();
        const dot = parseInt(keyEl.dataset.dot);
        activeDots.add(dot);
        keyEl.classList.add('active');
        updatePreview();
      });
      
      keyEl.addEventListener('mouseup', () => {
        keyEl.classList.remove('active');
      });
      
      keyEl.addEventListener('mouseleave', () => {
        keyEl.classList.remove('active');
      });
    });
    
    // Sync scroll between editors
    brailleEditor.addEventListener('scroll', () => {
      textEditor.scrollTop = brailleEditor.scrollTop;
    });
    
    textEditor.addEventListener('scroll', () => {
      brailleEditor.scrollTop = textEditor.scrollTop;
    });
    
    // ==================== INITIALIZATION ====================
    
    buildAlphabetReference();
    updateEditors();
    updatePreview();
  </script>
</body>
</html>